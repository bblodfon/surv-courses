{
  "hash": "9cb4ef16be58d1bb87f5d235e7291a30",
  "result": {
    "markdown": "# Cox Regression (low-dim) {-}\n\n\n\n\n::: {.cell hash='cox_regr_cache/html/libs_264562964a3db46e9187bf428f062e32'}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(tibble)\n```\n:::\n\n\nFrom 1962 to 1969 a number of patients with liver cirrhosis at several hospitals in Copenhagen were included in a randomized clinical trial. The purpose of the study was to investigate whether patients treated with the hormone prednisone had a better survival than patients who got an inactive placebo treatment. In this exercise, we will restrict attention to the $386$ patients in the study who had no excess fluid in the abdomen at entry. (Source: Andersen, Borgan, Gill & Keiding, Springer, 1993.)\n\nWe will study the effect of treatment with prednisone. We will also investigate the effect on survival of the **covariates** *sex*, *age*, and *prothrombin* index (a measurement based on a blood test of some coagulation factors produced by the liver, in percent of the normal value).\n\nYou may read the data into R by the command:\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-1_4c02b705ddb68ab97c327185b597e38b'}\n\n```{.r .cell-code}\nliver = read.table(\"https://www.med.uio.no/imb/english/research/centres/ocbe/courses/imb9335/liver.txt\", header=T) %>% as_tibble()\nliver\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 386 × 6\n   status  time treat   sex   age  prot\n    <int> <int> <int> <int> <int> <int>\n 1      0    22     0     0    75    94\n 2      0    24     0     0    53    26\n 3      0    24     1     0    76    43\n 4      0    25     0     1    46   100\n 5      1    27     0     1    76    71\n 6      0    29     0     1    51    68\n 7      0    30     1     1    49    72\n 8      0    30     0     1    36    84\n 9      0    30     1     1    54    60\n10      1    33     1     0    60   100\n# ℹ 376 more rows\n```\n:::\n:::\n\n\nThe data are organized with one line for each of the $386$ patients, and with the following variables in the six columns:\n\n- status: indicator for death/censoring (1=dead; 0=censored)\n- time: time in days from start of treatment to death/censoring\n- treat: treatment (0=prednisone; 1=placebo)\n- sex: gender (0=female; 1=male)\n- age: age in years at start of treatment\n- prot: prothrombin index\n\nTo get an overview of the data, we will first do univariate analyses of the effects of the covariates treatment, sex, age and prothrombin index using Kaplan-Meier plots and the log-rank tests.\n\nFor treatment, you may give the commands (when time is converted to years).\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-2_e269a4bc487fec5c103f4022611c74be'}\n\n```{.r .cell-code}\nfit.treat = survfit(Surv(time/365.25, status) ~ factor(treat), data = liver)\n\nplot(fit.treat, mark.time=FALSE, xlab=\"Years after randomization\", lty=1:2, main=\"KM - Treatment\")\nlegend(\"bottomleft\",c(\"Prednisone\",\"Placebo\"),lty=1:2)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-3_75fbf7d91055f22bd3126f970162b680'}\n\n```{.r .cell-code}\nsurvdiff(Surv(time/365.25,status) ~ factor(treat), data=liver)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(treat), \n    data = liver)\n\n                  N Observed Expected (O-E)^2/E (O-E)^2/V\nfactor(treat)=0 191       94      111      2.56      5.42\nfactor(treat)=1 195      117      100      2.83      5.42\n\n Chisq= 5.4  on 1 degrees of freedom, p= 0.02 \n```\n:::\n:::\n\n\na) Perform the commands and interpret the results.\n\nb) Perform similar analyses as in a) for the covariate sex. \n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-4_07836de974807c54352abed6fc9593a2'}\n\n```{.r .cell-code}\nfit.sex = survfit(Surv(time/365.25, status) ~ factor(sex), data = liver)\n\nplot(fit.sex, mark.time=FALSE, xlab=\"Years after randomization\", lty=1:2, main=\"KM - Sex\")\nlegend(\"bottomleft\", c(\"Female\",\"Male\"), lty=1:2)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-5_2d97f16b59dba23899e18c9ff976779e'}\n\n```{.r .cell-code}\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(sex), data = liver)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(sex), data = liver)\n\n                N Observed Expected (O-E)^2/E (O-E)^2/V\nfactor(sex)=0 159       81     91.8     1.268      2.25\nfactor(sex)=1 227      130    119.2     0.977      2.25\n\n Chisq= 2.3  on 1 degrees of freedom, p= 0.1 \n```\n:::\n:::\n\n\nWe want to do similar analyses as in a) and b) for the numeric covariates age and prothrombin index. But then we first have to make a grouping based on these covariates. In order to group age into the groups: 49 years or less, 50-59 years, 60-69 years, and 70 years or more, you may **create a new categorial covariate agegroup** by the command:\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-6_d5117b00a4620cb7d227fadce45eb018'}\n\n```{.r .cell-code}\nliver$agegroup=cut(liver$age, breaks=c(0,49,59,69,100),labels=1:4)\nunique(liver$agegroup)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4 2 1 3\nLevels: 1 2 3 4\n```\n:::\n:::\n\nc) Make a grouping of age by the command given above, and perform similar analyses for age group as the ones in a) and b).\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-7_f3481fdd20fc38e06aa3a0ae14bddbff'}\n\n```{.r .cell-code}\nfit.ageg = survfit(Surv(time/365.25, status) ~ factor(agegroup), data = liver)\n\nplot(fit.ageg, mark.time=FALSE, xlab=\"Years after randomization\", lty=1:4, main=\"KM - Age group\", col = 1:4)\nlegend(\"bottomleft\", c(\"0-49\",\"50-59\", \"60-69\", \"70-100\"), lty=1:4, col = 1:4)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-8_102482302b17333cf3b1b0e07d4faec6'}\n\n```{.r .cell-code}\n# factor() doesn't play a role here => in Cox regression it does!\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(agegroup), data = liver)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(agegroup), \n    data = liver)\n\n                     N Observed Expected (O-E)^2/E (O-E)^2/V\nfactor(agegroup)=1  74       23     46.4     11.78     15.16\nfactor(agegroup)=2 116       59     69.4      1.55      2.33\nfactor(agegroup)=3 146       97     73.2      7.78     12.05\nfactor(agegroup)=4  50       32     22.1      4.44      4.98\n\n Chisq= 25.8  on 3 degrees of freedom, p= 1e-05 \n```\n:::\n:::\n\n\nd) Make an appropriate grouping of prothrombin index and do similar analyses for grouped prothrombin as in a), b) and c).\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-9_638342853cbe6189528b77e77d3fa982'}\n\n```{.r .cell-code}\nquantile(liver$prot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  0%  25%  50%  75% 100% \n  26   58   72   90  135 \n```\n:::\n\n```{.r .cell-code}\nsummary(liver$prot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  26.00   58.00   72.00   73.55   90.00  135.00 \n```\n:::\n\n```{.r .cell-code}\nliver$protgroup = cut(liver$prot, breaks=c(0,58,90,135),labels=1:3)\nunique(liver$protgroup)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3 1 2\nLevels: 1 2 3\n```\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-10_3836cf6d9ff0e1f89c53762781400f36'}\n\n```{.r .cell-code}\nfit.protg = survfit(Surv(time/365.25, status) ~ factor(protgroup), data = liver)\n\nplot(fit.protg, mark.time=FALSE, xlab=\"Years after randomization\", lty=1:3, main=\"KM - Protgroup\", col = 1:3)\nlegend(\"bottomleft\", c(\"0-58\",\"59-90\", \"91-135\"), lty=1:3, col = 1:3)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n- Higher prot-index is better!!!\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-11_dffede644219e64b58da734979c6caa5'}\n\n```{.r .cell-code}\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(protgroup), data = liver)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(time/365.25, status) ~ factor(protgroup), \n    data = liver)\n\n                      N Observed Expected (O-E)^2/E (O-E)^2/V\nfactor(protgroup)=1 104       71     52.8     6.285     8.407\nfactor(protgroup)=2 190       99    102.8     0.137     0.268\nfactor(protgroup)=3  92       41     55.5     3.769     5.127\n\n Chisq= 10.2  on 2 degrees of freedom, p= 0.006 \n```\n:::\n:::\n\n\nIn order to study jointly the effects the covariates, we fit a Cox regression model with all covariates. If we use age and prothrombin as numeric covariates, we may give the commands:\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-12_413b85bcc1073ea9ac4719afa1e79de5'}\n\n```{.r .cell-code}\ncox.fit = coxph(Surv(time/365.25, status) ~ factor(treat) + factor(sex) + age + prot, data = liver)\n\nsummary(cox.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    age + prot, data = liver)\n\n  n= 386, number of events= 211 \n\n                    coef exp(coef)  se(coef)      z Pr(>|z|)    \nfactor(treat)1  0.292844  1.340233  0.139504  2.099  0.03580 *  \nfactor(sex)1    0.382945  1.466597  0.145403  2.634  0.00845 ** \nage             0.046925  1.048043  0.008038  5.838 5.28e-09 ***\nprot           -0.010607  0.989449  0.003351 -3.165  0.00155 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nfactor(treat)1    1.3402     0.7461     1.020     1.762\nfactor(sex)1      1.4666     0.6819     1.103     1.950\nage               1.0480     0.9542     1.032     1.065\nprot              0.9894     1.0107     0.983     0.996\n\nConcordance= 0.65  (se = 0.021 )\nLikelihood ratio test= 53.44  on 4 df,   p=7e-11\nWald test            = 50.36  on 4 df,   p=3e-10\nScore (logrank) test = 50.44  on 4 df,   p=3e-10\n```\n:::\n:::\n\n\n- Treat = 1 (placebo) or sex = 1 (male) or higher age is worse (**HR = exp(coef) > 1**) given that all the other covariates remain the same\n- Also smaller prot is worse (but not too much, also the same for age)\n\ne) Perform the commands, and interpret the estimated hazard ratios.\n\nf) Do you think that it is reasonable to use both age and prothrombin index as numeric covariates in the Cox regression model? If not, also fit model(s) where you use the grouped version of one or both of these covariates. Interpret the estimated hazard ratios.\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-13_3251a8f1a6dbb13d2ec082b3891891c8'}\n\n```{.r .cell-code}\ncox.fit2 = coxph(Surv(time/365.25, status) ~ factor(treat) + factor(sex) + agegroup + protgroup, data = liver)\nsummary(cox.fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    agegroup + protgroup, data = liver)\n\n  n= 386, number of events= 211 \n\n                  coef exp(coef) se(coef)      z Pr(>|z|)    \nfactor(treat)1  0.3267    1.3863   0.1406  2.324 0.020151 *  \nfactor(sex)1    0.3211    1.3787   0.1443  2.225 0.026057 *  \nagegroup2       0.4852    1.6245   0.2468  1.966 0.049307 *  \nagegroup3       1.0176    2.7665   0.2333  4.362 1.29e-05 ***\nagegroup4       1.0624    2.8933   0.2758  3.852 0.000117 ***\nprotgroup2     -0.3518    0.7034   0.1583 -2.223 0.026249 *  \nprotgroup3     -0.5966    0.5507   0.1972 -3.025 0.002489 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nfactor(treat)1    1.3863     0.7213    1.0524    1.8261\nfactor(sex)1      1.3787     0.7253    1.0390    1.8294\nagegroup2         1.6245     0.6156    1.0015    2.6351\nagegroup3         2.7665     0.3615    1.7514    4.3701\nagegroup4         2.8933     0.3456    1.6851    4.9679\nprotgroup2        0.7034     1.4216    0.5158    0.9593\nprotgroup3        0.5507     1.8160    0.3741    0.8106\n\nConcordance= 0.645  (se = 0.02 )\nLikelihood ratio test= 46.95  on 7 df,   p=6e-08\nWald test            = 43.47  on 7 df,   p=3e-07\nScore (logrank) test = 44.97  on 7 df,   p=1e-07\n```\n:::\n:::\n\n\nThis exercise is a continuation of the exercise on Cox regression for the liver cirrhosis data from yesterday. The liver cirrhosis data are described in the exercise from yesterday. There it is also explained how you may read the data into R.\n\nWe first fit a Cox regression model with all four covariates by the commands:\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-14_9b304e00d697574bf3d6b5a6e66cf6eb'}\n\n```{.r .cell-code}\ncox.fit=coxph(Surv(time/365.25,status)~factor(treat)+factor(sex)+age+prot,data=liver)\nsummary(cox.fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    age + prot, data = liver)\n\n  n= 386, number of events= 211 \n\n                    coef exp(coef)  se(coef)      z Pr(>|z|)    \nfactor(treat)1  0.292844  1.340233  0.139504  2.099  0.03580 *  \nfactor(sex)1    0.382945  1.466597  0.145403  2.634  0.00845 ** \nage             0.046925  1.048043  0.008038  5.838 5.28e-09 ***\nprot           -0.010607  0.989449  0.003351 -3.165  0.00155 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nfactor(treat)1    1.3402     0.7461     1.020     1.762\nfactor(sex)1      1.4666     0.6819     1.103     1.950\nage               1.0480     0.9542     1.032     1.065\nprot              0.9894     1.0107     0.983     0.996\n\nConcordance= 0.65  (se = 0.021 )\nLikelihood ratio test= 53.44  on 4 df,   p=7e-11\nWald test            = 50.36  on 4 df,   p=3e-10\nScore (logrank) test = 50.44  on 4 df,   p=3e-10\n```\n:::\n:::\n\n\n- Discuss the assumptions of the model fitted above.\n\nCHECK CONTINUOUS VARIABLES LOG-LINEARITY ASSUMPTION:\n\n- Investigate if there is a **log-linear effect of age**, we may give the commands:\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-15_c2b61ecfdee141f6ef681112826a62ef'}\n\n```{.r .cell-code}\ncox.spage=coxph(Surv(time/365.25,status)~factor(treat)+factor(sex)+pspline(age)+prot,data=liver)\nprint(cox.spage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    pspline(age) + prot, data = liver)\n\n                         coef se(coef)      se2    Chisq   DF       p\nfactor(treat)1        0.29335  0.14085  0.14049  4.33754 1.00  0.0373\nfactor(sex)1          0.37413  0.14599  0.14595  6.56715 1.00  0.0104\npspline(age), linear  0.04689  0.00820  0.00820 32.71358 1.00 1.1e-08\npspline(age), nonlin                             1.66153 3.09  0.6609\nprot                 -0.01081  0.00337  0.00337 10.26994 1.00  0.0014\n\nIterations: 4 outer, 12 Newton-Raphson\n     Theta= 0.802 \nDegrees of freedom for terms= 1.0 1.0 4.1 1.0 \nLikelihood ratio test=56.1  on 7.08 df, p=1e-09\nn= 386, number of events= 211 \n```\n:::\n\n```{.r .cell-code}\ntermplot(cox.spage,se=T,terms=3)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nDiscuss if it is reasonable to assume a log-linear effect of age? => **No => plot is linear**\n\n- Investigate if there is a log-linear effect of prothrombin index.\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-16_119494d229e0bf4f4642d8ae0d3b8a35'}\n\n```{.r .cell-code}\ncox.spprot=coxph(Surv(time/365.25,status)~factor(treat)+factor(sex)+age+pspline(prot),data=liver)\nprint(cox.spprot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    age + pspline(prot), data = liver)\n\n                          coef se(coef)      se2    Chisq   DF       p\nfactor(treat)1         0.31796  0.14161  0.14126  5.04114 1.00  0.0248\nfactor(sex)1           0.41439  0.14879  0.14846  7.75624 1.00  0.0054\nage                    0.04749  0.00811  0.00808 34.33445 1.00 4.6e-09\npspline(prot), linear -0.01031  0.00317  0.00317 10.60438 1.00  0.0011\npspline(prot), nonlin                             3.66752 3.05  0.3077\n\nIterations: 5 outer, 14 Newton-Raphson\n     Theta= 0.855 \nDegrees of freedom for terms= 1.0 1.0 1.0 4.1 \nLikelihood ratio test=57.7  on 7.04 df, p=5e-10\nn= 386, number of events= 211 \n```\n:::\n\n```{.r .cell-code}\ntermplot(cox.spprot,se=T,terms=4)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nThe result above gives some indication (but not very clear!) that the effect of prothrombin index is not log-linear. In the remainder of this exercise, we will work with prothrombin grouped in the three groups: (i) prothrombin index 49 or below, (ii) prothrombin index 50-89, and (iii) prothrombin index 90 or above. We may create a new categorial covariate protgroup by the command:\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-17_11c28d816baf67a0aaf334b21fe6fc16'}\n\n```{.r .cell-code}\nliver$protgroup=cut(liver$prot, breaks=c(0,49,89,150),labels=1:3)\n```\n:::\n\nWe may fit a Cox model with this variable (together with the other three covariates) by the commands\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-18_dbc8f95c7263b3ed4593dd0180d6b1dd'}\n\n```{.r .cell-code}\ncox.grfit=coxph(Surv(time/365.25,status)~factor(treat)+factor(sex)+age+factor(protgroup),data=liver)\nsummary(cox.grfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time/365.25, status) ~ factor(treat) + factor(sex) + \n    age + factor(protgroup), data = liver)\n\n  n= 386, number of events= 211 \n\n                        coef exp(coef)  se(coef)      z Pr(>|z|)    \nfactor(treat)1      0.289942  1.336351  0.139747  2.075 0.038008 *  \nfactor(sex)1        0.413701  1.512405  0.147978  2.796 0.005179 ** \nage                 0.047641  1.048794  0.008003  5.953 2.63e-09 ***\nfactor(protgroup)2 -0.578836  0.560550  0.182306 -3.175 0.001498 ** \nfactor(protgroup)3 -0.781223  0.457846  0.211930 -3.686 0.000228 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                   exp(coef) exp(-coef) lower .95 upper .95\nfactor(treat)1        1.3364     0.7483    1.0162    1.7574\nfactor(sex)1          1.5124     0.6612    1.1316    2.0213\nage                   1.0488     0.9535    1.0325    1.0654\nfactor(protgroup)2    0.5606     1.7840    0.3921    0.8013\nfactor(protgroup)3    0.4578     2.1841    0.3022    0.6936\n\nConcordance= 0.654  (se = 0.021 )\nLikelihood ratio test= 56.69  on 5 df,   p=6e-11\nWald test            = 55.11  on 5 df,   p=1e-10\nScore (logrank) test = 55.75  on 5 df,   p=9e-11\n```\n:::\n:::\n\n\nCheck if the assumption of proportional hazards seems to be fulfilled for the model:\n**a non-significant p-value means PH is okay/satisfied**, since $H_0 = (slope = 0)$, i.e. PH means that the time-dependent plot should approximately be a straight line:\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-19_7ff6e9937ab9aa26041a72ee01a74b4c'}\n\n```{.r .cell-code}\nphres = cox.zph(cox.grfit, terms = FALSE)\nphres\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   chisq df    p\nfactor(treat)1     0.892  1 0.34\nfactor(sex)1       1.653  1 0.20\nage                0.264  1 0.61\nfactor(protgroup)2 1.372  1 0.24\nfactor(protgroup)3 0.228  1 0.63\nGLOBAL             3.836  5 0.57\n```\n:::\n\n```{.r .cell-code}\nplot(phres)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-19-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-19-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-19-5.png){width=672}\n:::\n:::\n\n\nCheck this dependence with time: $b_1$ $b_1+b_{12}\\times log(t)$\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-20_2f86f785ca4535d96cc53787116948e3'}\n\n```{.r .cell-code}\nphres = cox.zph(cox.grfit, transform = 'log', terms = FALSE)\nphres\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   chisq df    p\nfactor(treat)1     0.240  1 0.62\nfactor(sex)1       1.006  1 0.32\nage                0.593  1 0.44\nfactor(protgroup)2 1.406  1 0.24\nfactor(protgroup)3 0.660  1 0.42\nGLOBAL             2.738  5 0.74\n```\n:::\n\n```{.r .cell-code}\nplot(phres)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-20-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-20-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-20-5.png){width=672}\n:::\n:::\n\n\nPredicting survival curves for new patients:\n\n- A prednisone treated woman aged 60 years who has prothrombin index 90 or above\n- A prednisone treated woman aged 60 years who has prothrombin index 49 or below\n- A placebo treated man aged 60 years who has prothrombin index 90 or above\n- A placebo treated man aged 60 years who has prothrombin index 49 or below\n\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-21_add1cfbbecfbfbffe6e20ad3b413fdf6'}\n\n```{.r .cell-code}\nnewdata = data.frame(\n  sex = c(0,0,1,1), \n  treat = c(0,0,1,1), \n  age = rep(60, 4),\n  protgroup = c(3,1,3,1))\nnewdata\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  sex treat age protgroup\n1   0     0  60         3\n2   0     0  60         1\n3   1     1  60         3\n4   1     1  60         1\n```\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-22_e49c56de747a37f02b5b427f5de78aa3'}\n\n```{.r .cell-code}\nsurv.res = survfit(cox.grfit, newdata = newdata)\nplot(surv.res, fun=\"cumhaz\", mark.time=FALSE, xlim=c(0,10),\nxlab=\"Years since operation\", ylab=\"Cumulative hazard\", lty=1:4, lwd=2, col = 1:4)\nlegend(\"topleft\",c(\"female, treated, 60y, progr = 3\",\"female, treated, 60y, protgr = 1\",\n\"male, placebo, 60y, progr = 3\",\"female, placebo, 60y, protgr = 1\"), lty=1:4,lwd=2, col = 1:4)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='cox_regr_cache/html/unnamed-chunk-23_9159f6fb4fb2e06ab5aabc61ad18b056'}\n\n```{.r .cell-code}\nplot(surv.res, fun=\"surv\", mark.time=FALSE, xlim=c(0,10),\nxlab=\"Years since operation\", ylab=\"Survival Probability\", lty=1:4, lwd=2, col = 1:4)\nlegend(\"topleft\",c(\"female, treated, 60y, progr = 3\",\"female, treated, 60y, protgr = 1\",\n\"male, placebo, 60y, progr = 3\",\"female, placebo, 60y, protgr = 1\"), lty=1:4,lwd=2, col = 1:4)\n```\n\n::: {.cell-output-display}\n![](cox_regr_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}